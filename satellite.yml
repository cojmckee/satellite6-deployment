---

#- name: setup server to be satellite or a capsule
#  hosts:
#    - satellite
#    - capsule
#  roles:
#    - setup-for-satellite

- name: set up satellite
  hosts:
    - satellite
  collections:
    - theforeman.foreman
  pre_tasks:
    - name: load in satellite vars
      include_vars:
        file: /home/jswanson/satellite6.6-dev-rearchitect/new-var-structure.proposed.yml
  roles:
    - install_satellite
    - tune_satellite
  tasks:
#     NOTE: operating systems are set up when repositories are synced, so do everything but that initially
    - name: set up all foreman settings but skip operating systems
      include_role:
        name: configure_foreman
        tasks_from: main-minus-operating-system.yml
    - name: build satellite by organization
      include_role:
        name: configure-satellite
      loop_control:
        loop_var: organization
      loop: "{{ satellite.organizations }}"
#  post_tasks:
#    - name: configure OSes
